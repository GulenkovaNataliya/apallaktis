# CRON JOB - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ Email –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –ß—Ç–æ —ç—Ç–æ?

Cron job - —ç—Ç–æ –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –æ–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–µ–∫–∞—é—â–∏–µ DEMO –∏ –ø–æ–¥–ø–∏—Å–∫–∏, –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–õ–æ–∫–∞–ª—å–Ω–æ)

### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (–∑–∞–ª–æ–≥–∏–Ω—å—Å—è —Å–Ω–∞—á–∞–ª–∞)
1. –û—Ç–∫—Ä–æ–π –±—Ä–∞—É–∑–µ—Ä
2. –ó–∞–π–¥–∏ –Ω–∞ http://localhost:3000 –∏ –∑–∞–ª–æ–≥–∏–Ω—å—Å—è
3. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞: http://localhost:3000/api/cron/check-expiring-subscriptions
4. –£–≤–∏–¥–∏—à—å JSON –æ—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ PowerShell (–±–µ–∑ –ª–æ–≥–∏–Ω–∞)
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/api/cron/check-expiring-subscriptions" -Headers @{"Authorization"="Bearer apallaktis_cron_secret_2026"} -UseBasicParsing
```

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:
- –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ DEMO/–ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- –û—Ç–ø—Ä–∞–≤–∏—Ç email —Ç–µ–º, –∫–æ–º—É –Ω—É–∂–Ω–æ
- –í–µ—Ä–Ω—ë—Ç JSON —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π:
```json
{
  "success": true,
  "checked_at": "2026-01-08T12:00:00.000Z",
  "stats": {
    "expiring_demos": 2,
    "expired_demos": 1,
    "expiring_subscriptions": 3,
    "expired_subscriptions": 0
  }
}
```

---

## üìÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (Production)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Vercel Cron (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `vercel.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```json
{
  "crons": [{
    "path": "/api/cron/check-expiring-subscriptions",
    "schedule": "0 10 * * *"
  }]
}
```

2. `"0 10 * * *"` –æ–∑–Ω–∞—á–∞–µ—Ç: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00 UTC (13:00 –ø–æ –≥—Ä–µ—á–µ—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –∑–∏–º–æ–π)

3. –î–µ–ø–ª–æ–π –Ω–∞ Vercel - cron –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–°—Ç–æ–∏–º–æ—Å—Ç—å**: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞ Pro –ø–ª–∞–Ω–µ ($20/–º–µ—Å—è—Ü)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: EasyCron (–í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)

1. –ó–∞–π–¥–∏ –Ω–∞ https://www.easycron.com
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π cron job:
   - URL: `https://apallaktis.gr/api/cron/check-expiring-subscriptions`
   - Header: `Authorization: Bearer apallaktis_cron_secret_2026`
   - Schedule: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
3. –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 1 –∑–∞–¥–∞—á–∏

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: cron-job.org

1. –ó–∞–π–¥–∏ –Ω–∞ https://cron-job.org
2. –°–æ–∑–¥–∞–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
3. –î–æ–±–∞–≤—å job:
   - URL: `https://apallaktis.gr/api/cron/check-expiring-subscriptions`
   - Schedule: `0 10 * * *`
   - Request method: GET
   - Custom headers: `Authorization: Bearer apallaktis_cron_secret_2026`

**–°—Ç–æ–∏–º–æ—Å—Ç—å**: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

Cron endpoint –∑–∞—â–∏—â—ë–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º: `CRON_SECRET`

–ë–µ–∑ –Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω:
```json
{
  "error": "Unauthorized"
}
```

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ù–∞ production –∑–∞–º–µ–Ω–∏ —Å–µ–∫—Ä–µ—Ç –Ω–∞ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π:
```env
CRON_SECRET=your_very_secure_random_string_here_123456
```

---

## üìä –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cron job?

### 1. DEMO –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `subscription_status = 'demo'`
- –ü–µ—Ä–∏–æ–¥: `demo_expires_at` –º–µ–∂–¥—É NOW –∏ NOW+24h
- Email: "‚è∞ –í–∞—à–µ DEMO –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∑–∞–≤—Ç—Ä–∞"

### 2. DEMO –∏—Å—Ç–µ–∫–ª–æ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `subscription_status = 'read-only'`
- –ü–µ—Ä–∏–æ–¥: `demo_expires_at` –º–µ–∂–¥—É NOW-24h –∏ NOW
- Email: "‚ùå –í–∞—à–µ DEMO –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å"

### 3. –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 2 –¥–Ω—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `subscription_status IN ('active', 'vip')`
- –ü–µ—Ä–∏–æ–¥: `subscription_expires_at` –º–µ–∂–¥—É NOW –∏ NOW+2days
- Email: "‚è∞ –ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 –¥–Ω—è"

### 4. –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `subscription_status = 'expired'`
- –ü–µ—Ä–∏–æ–¥: `subscription_expires_at` –º–µ–∂–¥—É NOW-24h –∏ NOW
- Email: "‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞"

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
–ö–æ–≥–¥–∞ cron job –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≥–¥–µ `npm run dev`) –±—É–¥—É—Ç –ª–æ–≥–∏:
```
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫...
üìß –ù–∞–π–¥–µ–Ω–æ 2 DEMO, –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
‚úÖ Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: user@example.com (#1001)
‚úÖ Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: user2@example.com (#1002)
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
–ó–∞–π–¥–∏ –≤ Supabase ‚Üí Table Editor ‚Üí profiles ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏:
- `demo_expiring_email_sent` - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `true`
- `demo_expired_email_sent`
- `subscription_expiring_email_sent`
- `subscription_expired_email_sent`

---

## ‚ùì FAQ

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å cron job?**
A: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å, —É—Ç—Ä–æ–º (10:00 UTC).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —á–∞—â–µ?**
A: –î–∞, –Ω–æ –Ω–µ—Ç —Å–º—ã—Å–ª–∞. Email —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã, —Ñ–ª–∞–≥–∏ `_email_sent` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `true`.

**Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–∏—Å—å–º–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å?**
A: Cron job –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å (–µ—Å–ª–∏ —Ñ–ª–∞–≥ –≤—Å—ë –µ—â—ë `false`).

**Q: –ù—É–∂–Ω–æ –ª–∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ `_email_sent`?**
A: –ù–µ—Ç, –æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è `true` –Ω–∞–≤—Å–µ–≥–¥–∞. –ö–∞–∂–¥–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑.
