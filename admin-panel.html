<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î‘Î Î‘Î›Î›Î‘ÎšÎ¤Î—Î£ â€” Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Manrope',sans-serif;background:#fff;color:#1a1a2e}
        .header{background:#1a1a2e;padding:15px 40px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
        .logo{height:45px}.exit-btn{background:#e74c3c;border:none;color:#fff;padding:10px 25px;border-radius:8px;cursor:pointer;font-weight:600}
        .container{max-width:1800px;margin:0 auto;padding:30px}
        .stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:15px;margin-bottom:30px}
        .stat-card{border-radius:12px;padding:20px;color:#fff;text-align:center;cursor:pointer}
        .stat-card:nth-child(1){background:linear-gradient(135deg,#11998e,#38ef7d)}
        .stat-card:nth-child(2){background:linear-gradient(135deg,#4facfe,#00f2fe)}
        .stat-card:nth-child(3){background:linear-gradient(135deg,#fa709a,#fee140)}
        .stat-card:nth-child(4){background:linear-gradient(135deg,#a18cd1,#fbc2eb)}
        .stat-card:nth-child(5){background:linear-gradient(135deg,#667eea,#764ba2)}
        .stat-card:nth-child(6){background:linear-gradient(135deg,#f093fb,#f5576c)}
        .stat-card:nth-child(7){background:linear-gradient(135deg,#4facfe,#00f2fe)}
        .stat-card:nth-child(8){background:linear-gradient(135deg,#f5af19,#f12711)}
        .stat-card:nth-child(9){background:linear-gradient(135deg,#11998e,#38ef7d)}
        .stat-card:nth-child(10){background:linear-gradient(135deg,#667eea,#764ba2)}
        .stat-number{font-size:36px;font-weight:800}.stat-label{font-size:11px;font-weight:600;text-transform:uppercase;margin-top:5px}
        .section{background:#f8f9fa;border-radius:16px;margin-bottom:25px;border:2px solid #e9ecef;overflow:hidden}
        .section-header{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;padding:18px 25px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
        .section-header h2{font-size:18px}.toggle-icon{font-size:18px;transition:transform .3s}
        .section.open .toggle-icon{transform:rotate(180deg)}.section-content{display:none;padding:20px;background:#fff}.section.open .section-content{display:block}
        .controls{display:flex;gap:12px;margin-bottom:15px;flex-wrap:wrap;align-items:center}
        .search-box{flex:1;min-width:200px;position:relative}
        .search-box input{width:100%;padding:10px 12px 10px 35px;border:2px solid #e9ecef;border-radius:8px;font-size:14px}
        .search-box::before{content:"ğŸ”";position:absolute;left:10px;top:50%;transform:translateY(-50%)}
        .filter-select{padding:10px;border:2px solid #e9ecef;border-radius:8px;font-size:13px}
        .export-btn{background:linear-gradient(135deg,#11998e,#38ef7d);color:#fff;border:none;padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer}
        .table-wrapper{overflow-x:auto;border-radius:8px;border:1px solid #e9ecef}
        table{width:100%;border-collapse:collapse;min-width:1100px}
        th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #e9ecef;font-size:12px}
        th{background:#f8f9fa;font-weight:700;font-size:10px;text-transform:uppercase;color:#495057}
        .badge{display:inline-block;padding:2px 6px;border-radius:10px;font-size:9px;font-weight:700;text-transform:uppercase}
        .badge.vip{background:linear-gradient(135deg,#f5af19,#f12711);color:#fff}
        .badge.active{background:#d4edda;color:#155724}.badge.demo{background:#e2e3f3;color:#383d8b}
        .badge.expired{background:#f8d7da;color:#721c24}.badge.read-only{background:#fff3cd;color:#856404}
        .badge.basic{background:#e9ecef;color:#495057}.badge.standard{background:#cce5ff;color:#004085}
        .badge.premium{background:#d4edda;color:#155724}.badge.timologio{background:#e3f2fd;color:#1565c0}.badge.apodeixi{background:#fff3e0;color:#e65100}
        .action-btn{padding:4px 6px;border:none;border-radius:4px;font-size:10px;font-weight:600;cursor:pointer;margin:1px}
        .action-btn.view{background:#e8eaf6;color:#3f51b5}.action-btn.edit{background:#e3f2fd;color:#1976d2}
        .action-btn.vip{background:#fff3cd;color:#856404}.action-btn.send{background:#d4edda;color:#155724}
        .action-btn.delete{background:#f8d7da;color:#721c24}
        .workflow-status{display:flex;flex-direction:column;gap:1px}.workflow-step{display:flex;align-items:center;gap:3px;font-size:9px}
        .workflow-step .check{width:10px;height:10px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:7px}
        .workflow-step .check.done{background:#28a745;color:#fff}.workflow-step .check.not-done{background:#e9ecef}
        .total-count{background:#f8f9fa;padding:8px 12px;border-radius:8px;margin-bottom:10px;font-weight:600;font-size:13px}
        .total-count span{color:#FF6B35}
        .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center;padding:20px}
        .modal-overlay.active{display:flex}.modal{background:#fff;border-radius:16px;padding:25px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto}
        .modal h3{font-size:18px;margin-bottom:15px}.modal-field{margin-bottom:10px}
        .modal-field label{display:block;margin-bottom:4px;font-weight:600;font-size:12px}
        .modal-field input,.modal-field select{width:100%;padding:8px;border:2px solid #e9ecef;border-radius:6px;font-size:13px}
        .modal-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .modal-actions{display:flex;gap:10px;margin-top:15px}
        .modal-actions button{flex:1;padding:10px;border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer}
        .modal-actions .save-btn{background:linear-gradient(135deg,#FF6B35,#F7C59F);color:#fff}
        .modal-actions .cancel-btn{background:#e9ecef;color:#495057}
        .timologio-fields{background:#e3f2fd;border:2px solid #1565c0;border-radius:8px;padding:10px;margin-top:10px}
        .timologio-fields h4{color:#1565c0;margin-bottom:8px;font-size:12px}
        .vip-info{background:#fff3cd;border:2px solid #f5af19;border-radius:8px;padding:10px;margin-top:10px}
        .vip-info h4{color:#856404;margin-bottom:6px;font-size:12px}
        .payment-item{background:#f8f9fa;padding:8px;border-radius:6px;margin-bottom:5px;display:flex;justify-content:space-between}
        .payment-item .amount{font-weight:700;color:#11998e}
    </style>
</head>
<body>
<header class="header">
    <img src="/Apallaktis.photos/apallaktis-logo-orange@2x.png" alt="Î‘Î Î‘Î›Î›Î‘ÎšÎ¤Î—Î£" class="logo">
    <button class="exit-btn" onclick="logout()">ğŸšª Ğ’Ñ‹Ñ…Ğ¾Ğ´</button>
</header>
<div class="container">
    <section class="stats-grid">
        <div class="stat-card"><div class="stat-number" id="stat-total">0</div><div class="stat-label">Ğ’ÑĞµĞ³Ğ¾</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-active">0</div><div class="stat-label">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-readonly">0</div><div class="stat-label">Only Read</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-demo">0</div><div class="stat-label">DEMO</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-basic">0</div><div class="stat-label">Basic</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-standard">0</div><div class="stat-label">Standard</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-premium">0</div><div class="stat-label">Premium</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-vip">0</div><div class="stat-label">VIP</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-referrals">0</div><div class="stat-label">Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»Ğ¾Ğ²</div></div>
        <div class="stat-card"><div class="stat-number" id="stat-revenue">â‚¬0</div><div class="stat-label">Ğ”Ğ¾Ñ…Ğ¾Ğ´</div></div>
    </section>
    <section id="users" class="section open">
        <div class="section-header" onclick="toggleSection(this)"><h2>ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</h2><span class="toggle-icon">â–¼</span></div>
        <div class="section-content">
            <div class="controls">
                <div class="search-box"><input type="text" id="user-search" placeholder="ĞŸĞ¾Ğ¸ÑĞº" oninput="filterUsers()"></div>
                <select class="filter-select" id="user-status-filter" onchange="filterUsers()"><option value="all">Ğ’ÑĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑÑ‹</option><option value="vip">vip</option><option value="active">active</option><option value="demo">demo</option><option value="expired">expired</option><option value="read-only">read-only</option></select>
                <select class="filter-select" id="user-plan-filter" onchange="filterUsers()"><option value="all">Ğ’ÑĞµ Ğ¿Ğ»Ğ°Ğ½Ñ‹</option><option value="Basic">Basic</option><option value="Standard">Standard</option><option value="Premium">Premium</option><option value="VIP">VIP</option></select>
                <select class="filter-select" id="user-doc-filter" onchange="filterUsers()"><option value="all">Ğ’ÑĞµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹</option><option value="Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ">Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ</option><option value="Î‘Î ÎŸÎ”Î•Î™ÎÎ—">Î‘Î ÎŸÎ”Î•Î™ÎÎ—</option></select>
                <button class="export-btn" onclick="exportUsersToExcel()">ğŸ“¥ Excel</button>
            </div>
            <div class="total-count">ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾: <span id="filtered-user-count">0</span></div>
            <div class="table-wrapper"><table><thead><tr><th>ID</th><th>Ğ˜Ğ¼Ñ</th><th>Email</th><th>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</th><th>Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚</th><th>Î‘Î¦Îœ</th><th>Status</th><th>Plan</th><th>Ğ”Ğ°Ñ‚Ğ°</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr></thead><tbody id="users-tbody"></tbody></table></div>
        </div>
    </section>
    <section id="payments" class="section">
        <div class="section-header" onclick="toggleSection(this)"><h2>ğŸ’° Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹</h2><span class="toggle-icon">â–¼</span></div>
        <div class="section-content">
            <div class="controls">
                <div class="search-box"><input type="text" id="payment-search" placeholder="ĞŸĞ¾Ğ¸ÑĞº" oninput="filterPayments()"></div>
                <select class="filter-select" id="doc-sent-filter" onchange="filterPayments()"><option value="all">Ğ’ÑĞµ</option><option value="not-sent">âš ï¸ ĞĞµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½</option><option value="sent">âœ“ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½</option></select>
                <button class="export-btn" onclick="exportPaymentsToExcel()">ğŸ“¥ Excel</button>
            </div>
            <div class="total-count">ĞŸĞ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹: <span id="filtered-payment-count">0</span></div>
            <div class="table-wrapper"><table><thead><tr><th>Ğ”Ğ°Ñ‚Ğ°</th><th>Ğ˜Ğ¼Ñ</th><th>Email</th><th>Ğ¡ÑƒĞ¼Ğ¼Ğ°</th><th>ĞŸĞ»Ğ°Ğ½</th><th>Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚</th><th>Î‘Î¦Îœ</th><th>Workflow</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr></thead><tbody id="payments-tbody"></tbody></table></div>
        </div>
    </section>
    <section id="referrals" class="section">
        <div class="section-header" onclick="toggleSection(this)"><h2>ğŸ Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»Ñ‹</h2><span class="toggle-icon">â–¼</span></div>
        <div class="section-content">
            <div class="controls"><button class="export-btn" onclick="exportReferralsToExcel()">ğŸ“¥ Excel</button></div>
            <div class="table-wrapper"><table><thead><tr><th>Ğ ĞµÑ„ĞµÑ€ĞµÑ€</th><th>Email</th><th>ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¾</th><th>ĞšÑƒĞ¿Ğ¸Ğ»Ğ¸</th><th>Ğ‘Ğ¾Ğ½ÑƒÑ</th></tr></thead><tbody id="referrals-tbody"></tbody></table></div>
        </div>
    </section>
    <section id="vip" class="section">
        <div class="section-header" onclick="toggleSection(this)"><h2>â­ VIP</h2><span class="toggle-icon">â–¼</span></div>
        <div class="section-content">
            <div class="controls">
                <button class="export-btn" onclick="exportVipToExcel()">ğŸ“¥ Excel</button>
                <button class="export-btn" style="background:linear-gradient(135deg,#f5af19,#f12711)" onclick="openAddVipModal()">â­ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ VIP</button>
            </div>
            <div class="total-count">VIP: <span id="vip-count">0</span></div>
            <div class="table-wrapper"><table><thead><tr><th>Ğ˜Ğ¼Ñ</th><th>Email</th><th>VIP Ñ</th><th>vip_expires_at</th><th>vip_granted_by</th><th>vip_reason</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr></thead><tbody id="vip-tbody"></tbody></table></div>
        </div>
    </section>
</div>

<div class="modal-overlay" id="user-modal"><div class="modal"><h3>ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</h3><div id="user-modal-content"></div><div class="modal-actions"><button class="cancel-btn" onclick="closeModal('user-modal')">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button></div></div></div>

<div class="modal-overlay" id="edit-modal"><div class="modal"><h3>âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ</h3>
<div class="modal-row"><div class="modal-field"><label>Ğ˜Ğ¼Ñ</label><input type="text" id="edit-name"></div><div class="modal-field"><label>Email</label><input type="email" id="edit-email"></div></div>
<div class="modal-row"><div class="modal-field"><label>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</label><input type="tel" id="edit-phone"></div><div class="modal-field"><label>Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚</label><select id="edit-doc-type" onchange="toggleTimologioFields()"><option value="Î‘Î ÎŸÎ”Î•Î™ÎÎ—">Î‘Î ÎŸÎ”Î•Î™ÎÎ—</option><option value="Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ">Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ</option></select></div></div>
<div class="modal-row"><div class="modal-field"><label>subscription_status</label><select id="edit-status"><option value="demo">demo</option><option value="active">active</option><option value="expired">expired</option><option value="read-only">read-only</option><option value="vip">vip</option></select></div><div class="modal-field"><label>subscription_plan</label><select id="edit-plan"><option value="">null</option><option value="Basic">Basic</option><option value="Standard">Standard</option><option value="Premium">Premium</option><option value="VIP">VIP</option></select></div></div>
<div id="timologio-section" class="timologio-fields" style="display:none"><h4>ğŸ“‹ Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ</h4><div class="modal-row"><div class="modal-field"><label>Î‘Î¦Îœ</label><input type="text" id="edit-afm"></div><div class="modal-field"><label>Î”ÎŸÎ¥</label><input type="text" id="edit-doy"></div></div><div class="modal-field"><label>ĞšĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ</label><input type="text" id="edit-company"></div><div class="modal-field"><label>Ğ”ĞµÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ</label><input type="text" id="edit-activity"></div><div class="modal-field"><label>ĞĞ´Ñ€ĞµÑ</label><input type="text" id="edit-company-address"></div></div>
<div class="modal-actions"><button class="cancel-btn" onclick="closeModal('edit-modal')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button><button class="save-btn" onclick="saveUserEdit()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button></div>
</div></div>

<div class="modal-overlay" id="vip-modal"><div class="modal"><h3>â­ ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ VIP</h3>
<div class="modal-field"><label>Email</label><input type="email" id="vip-email-input" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ email"></div>
<div class="modal-field"><label>Ğ¡Ñ€Ğ¾Ğº (vip_expires_at)</label><select id="vip-duration" onchange="toggleCustomDate()"><option value="forever">Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ¾ (+100 Ğ»ĞµÑ‚)</option><option value="1">1 Ğ¼ĞµÑÑÑ†</option><option value="3">3 Ğ¼ĞµÑÑÑ†Ğ°</option><option value="6">6 Ğ¼ĞµÑÑÑ†ĞµĞ²</option><option value="12">1 Ğ³Ğ¾Ğ´</option><option value="custom">Ğ£ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ°Ñ‚Ñƒ</option></select></div>
<div class="modal-field" id="custom-date-field" style="display:none"><label>Ğ”Ğ°Ñ‚Ğ°</label><input type="date" id="vip-custom-date"></div>
<div class="modal-field"><label>vip_reason</label><input type="text" id="vip-reason" placeholder="ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°..."></div>
<div class="vip-info"><h4>ĞŸÑ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸:</h4><div style="font-size:11px">subscription_status â†’ 'vip'<br>subscription_plan â†’ 'VIP'<br>vip_expires_at â†’ Ğ´Ğ°Ñ‚Ğ°<br>vip_granted_by â†’ ID Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°<br>+ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° email</div></div>
<div class="modal-actions"><button class="cancel-btn" onclick="closeModal('vip-modal')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button><button class="save-btn" onclick="activateVIP()">â­ ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button></div>
</div></div>

<script>
const ADMIN_ID='uuid-admin';
let users=[
{id:'uuid-1001',name:'Admin',email:'admin@example.com',phone:'+30 693 111',subscription_status:'vip',subscription_plan:'VIP',docType:'Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ',created_at:'2026-01-01',vip_expires_at:'2126-01-01T00:00:00Z',vip_granted_by:'uuid-admin',vip_reason:'ĞÑĞ½Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',afm:'123456789',doy:'Î‘Î„ Î‘Î¸Î·Î½ÏÎ½',company:'Company A',activity:'IT',companyAddress:'Athens',referrer:null,payments:[{date:'2026-01-01',amount:0,plan:'VIP',stripeReceived:true,docCreated:true,docSent:true}]},
{id:'uuid-1002',name:'Demo User',email:'demo@example.com',phone:'+30 694 222',subscription_status:'demo',subscription_plan:null,docType:'Î‘Î ÎŸÎ”Î•Î™ÎÎ—',created_at:'2026-01-15',vip_expires_at:null,vip_granted_by:null,vip_reason:null,afm:'',doy:'',company:'',activity:'',companyAddress:'',referrer:'uuid-1001',payments:[]},
{id:'uuid-1003',name:'Basic User',email:'basic@example.com',phone:'+30 695 333',subscription_status:'active',subscription_plan:'Basic',docType:'Î‘Î ÎŸÎ”Î•Î™ÎÎ—',created_at:'2026-01-10',vip_expires_at:null,vip_granted_by:null,vip_reason:null,afm:'',doy:'',company:'',activity:'',companyAddress:'',referrer:null,payments:[{date:'2026-01-10',amount:24.80,plan:'Basic',stripeReceived:true,docCreated:true,docSent:false}]},
{id:'uuid-1004',name:'Standard User',email:'standard@example.com',phone:'+30 696 444',subscription_status:'active',subscription_plan:'Standard',docType:'Î‘Î ÎŸÎ”Î•Î™ÎÎ—',created_at:'2026-01-08',vip_expires_at:null,vip_granted_by:null,vip_reason:null,afm:'',doy:'',company:'',activity:'',companyAddress:'',referrer:'uuid-1001',payments:[{date:'2026-01-08',amount:49.60,plan:'Standard',stripeReceived:true,docCreated:true,docSent:true}]},
{id:'uuid-1005',name:'Premium User',email:'premium@example.com',phone:'+30 697 555',subscription_status:'active',subscription_plan:'Premium',docType:'Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ',created_at:'2026-01-05',vip_expires_at:null,vip_granted_by:null,vip_reason:null,afm:'987654321',doy:'Î’Î„ Î˜ÎµÏƒ',company:'Company B',activity:'Trade',companyAddress:'Thessaloniki',referrer:null,payments:[{date:'2026-01-05',amount:93.00,plan:'Premium',stripeReceived:true,docCreated:true,docSent:true}]},
{id:'uuid-1006',name:'Read Only',email:'readonly@example.com',phone:'+30 698 666',subscription_status:'read-only',subscription_plan:'Basic',docType:'Î‘Î ÎŸÎ”Î•Î™ÎÎ—',created_at:'2025-12-01',vip_expires_at:null,vip_granted_by:null,vip_reason:null,afm:'',doy:'',company:'',activity:'',companyAddress:'',referrer:null,payments:[]},
{id:'uuid-1007',name:'Expired User',email:'expired@example.com',phone:'+30 699 777',subscription_status:'expired',subscription_plan:'Standard',docType:'Î‘Î ÎŸÎ”Î•Î™ÎÎ—',created_at:'2025-06-01',vip_expires_at:null,vip_granted_by:null,vip_reason:null,afm:'',doy:'',company:'',activity:'',companyAddress:'',referrer:null,payments:[{date:'2025-06-01',amount:49.60,plan:'Standard',stripeReceived:true,docCreated:true,docSent:true}]}
];
let currentEditUserId=null;

document.addEventListener('DOMContentLoaded',()=>{updateStats();renderUsers();renderPayments();renderReferrals();renderVipUsers();});

function updateStats(){
    document.getElementById('stat-total').textContent=users.length;
    document.getElementById('stat-active').textContent=users.filter(u=>u.subscription_status==='active').length;
    document.getElementById('stat-readonly').textContent=users.filter(u=>u.subscription_status==='read-only').length;
    document.getElementById('stat-demo').textContent=users.filter(u=>u.subscription_status==='demo').length;
    document.getElementById('stat-basic').textContent=users.filter(u=>u.subscription_plan==='Basic').length;
    document.getElementById('stat-standard').textContent=users.filter(u=>u.subscription_plan==='Standard').length;
    document.getElementById('stat-premium').textContent=users.filter(u=>u.subscription_plan==='Premium').length;
    document.getElementById('stat-vip').textContent=users.filter(u=>u.subscription_status==='vip').length;
    document.getElementById('stat-referrals').textContent=users.filter(u=>u.referrer).length;
    let rev=0;users.forEach(u=>u.payments.forEach(p=>rev+=p.amount));
    document.getElementById('stat-revenue').textContent='â‚¬'+rev.toFixed(0);
    document.getElementById('vip-count').textContent=users.filter(u=>u.subscription_status==='vip').length;
}

function toggleSection(h){h.parentElement.classList.toggle('open');}

function renderUsers(f=users){
    const t=document.getElementById('users-tbody');t.innerHTML='';
    [...f].sort((a,b)=>new Date(b.created_at)-new Date(a.created_at)).forEach(u=>{
        const plan=u.subscription_plan||'DEMO';
        const tr=document.createElement('tr');
        tr.innerHTML=`<td><small>${u.id.slice(0,8)}</small></td><td><b>${u.name}</b></td><td>${u.email}</td><td>${u.phone}</td>
        <td><span class="badge ${u.docType==='Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ'?'timologio':'apodeixi'}">${u.docType}</span></td>
        <td>${u.docType==='Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ'?u.afm:'-'}</td>
        <td><span class="badge ${u.subscription_status}">${u.subscription_status}</span></td>
        <td><span class="badge ${plan.toLowerCase()}">${plan}</span></td>
        <td>${u.created_at}</td>
        <td><button class="action-btn view" onclick="viewUser('${u.id}')">ğŸ‘ï¸</button><button class="action-btn edit" onclick="editUser('${u.id}')">âœï¸</button>${u.subscription_status!=='vip'?`<button class="action-btn vip" onclick="quickVip('${u.id}')">â­</button>`:''}</td>`;
        t.appendChild(tr);
    });
    document.getElementById('filtered-user-count').textContent=f.length;
}

function filterUsers(){
    const s=document.getElementById('user-search').value.toLowerCase();
    const st=document.getElementById('user-status-filter').value;
    const pl=document.getElementById('user-plan-filter').value;
    const dc=document.getElementById('user-doc-filter').value;
    const f=users.filter(u=>{
        const ms=u.name.toLowerCase().includes(s)||u.email.toLowerCase().includes(s)||(u.afm&&u.afm.includes(s));
        const mst=st==='all'||u.subscription_status===st;
        const mpl=pl==='all'||u.subscription_plan===pl;
        const mdc=dc==='all'||u.docType===dc;
        return ms&&mst&&mpl&&mdc;
    });
    renderUsers(f);
}

function renderPayments(){
    const t=document.getElementById('payments-tbody');t.innerHTML='';
    let all=[];users.forEach(u=>u.payments.forEach(p=>all.push({...p,user:u})));
    const s=document.getElementById('payment-search')?.value.toLowerCase()||'';
    const df=document.getElementById('doc-sent-filter')?.value||'all';
    all=all.filter(p=>{
        const ms=p.user.name.toLowerCase().includes(s)||p.user.email.toLowerCase().includes(s);
        const md=df==='all'||(df==='sent'&&p.docSent)||(df==='not-sent'&&!p.docSent);
        return ms&&md;
    }).sort((a,b)=>new Date(b.date)-new Date(a.date));
    all.forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${p.date}</td><td><b>${p.user.name}</b></td><td>${p.user.email}</td><td><b>â‚¬${p.amount.toFixed(2)}</b></td><td>${p.plan||'DEMO'}</td>
        <td><span class="badge ${p.user.docType==='Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ'?'timologio':'apodeixi'}">${p.user.docType}</span></td>
        <td>${p.user.docType==='Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ'?p.user.afm:'-'}</td>
        <td><div class="workflow-status"><div class="workflow-step"><span class="check ${p.stripeReceived?'done':'not-done'}">${p.stripeReceived?'âœ“':''}</span>Stripe</div><div class="workflow-step"><span class="check ${p.docCreated?'done':'not-done'}">${p.docCreated?'âœ“':''}</span>Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½</div><div class="workflow-step"><span class="check ${p.docSent?'done':'not-done'}">${p.docSent?'âœ“':''}</span>ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½</div></div></td>
        <td>${!p.docCreated?`<button class="action-btn edit" onclick="markDocCreated('${p.user.id}','${p.date}')">ğŸ“</button>`:''}${p.docCreated&&!p.docSent?`<button class="action-btn send" onclick="markDocSent('${p.user.id}','${p.date}')">ğŸ“§</button>`:''}</td>`;
        t.appendChild(tr);
    });
    document.getElementById('filtered-payment-count').textContent=all.length;
}

function filterPayments(){renderPayments();}

function renderReferrals(){
    const t=document.getElementById('referrals-tbody');t.innerHTML='';
    const refs={};
    users.forEach(u=>{if(u.referrer){const r=users.find(x=>x.id===u.referrer);if(r){if(!refs[r.id])refs[r.id]={user:r,invited:0,purchased:0};refs[r.id].invited++;if(u.subscription_status!=='demo')refs[r.id].purchased++;}}});
    Object.values(refs).forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td><b>${r.user.name}</b></td><td>${r.user.email}</td><td>${r.invited}</td><td>${r.purchased}</td><td>${r.purchased} Ğ¼ĞµÑ.</td>`;t.appendChild(tr);});
}

function renderVipUsers(){
    const t=document.getElementById('vip-tbody');t.innerHTML='';
    users.filter(u=>u.subscription_status==='vip').forEach(u=>{
        const exp=u.vip_expires_at?(new Date(u.vip_expires_at).getFullYear()>2100?'Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ¾':u.vip_expires_at.split('T')[0]):'-';
        const tr=document.createElement('tr');
        tr.innerHTML=`<td><b>${u.name}</b></td><td>${u.email}</td><td>${u.created_at}</td><td>${exp}</td><td>${u.vip_granted_by||'-'}</td><td>${u.vip_reason||'-'}</td><td><button class="action-btn delete" onclick="removeVip('${u.id}')">âŒ</button></td>`;
        t.appendChild(tr);
    });
}

function viewUser(id){
    const u=users.find(x=>x.id===id);if(!u)return;
    const plan=u.subscription_plan||'DEMO';
    let h=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px;margin-bottom:12px">
    <div><b>ID:</b> ${u.id}</div><div><b>Ğ˜Ğ¼Ñ:</b> ${u.name}</div><div><b>Email:</b> ${u.email}</div><div><b>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:</b> ${u.phone}</div>
    <div><b>subscription_status:</b> <span class="badge ${u.subscription_status}">${u.subscription_status}</span></div>
    <div><b>subscription_plan:</b> <span class="badge ${plan.toLowerCase()}">${plan}</span></div></div>`;
    if(u.subscription_status==='vip'){
        const exp=u.vip_expires_at?(new Date(u.vip_expires_at).getFullYear()>2100?'Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ¾':u.vip_expires_at):'-';
        h+=`<div class="vip-info"><h4>â­ VIP</h4><div style="font-size:11px"><b>vip_expires_at:</b> ${exp}<br><b>vip_granted_by:</b> ${u.vip_granted_by||'-'}<br><b>vip_reason:</b> ${u.vip_reason||'-'}</div></div>`;
    }
    if(u.docType==='Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ'){
        h+=`<div class="timologio-fields"><h4>ğŸ“‹ Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ</h4><div style="font-size:11px"><b>Î‘Î¦Îœ:</b> ${u.afm}<br><b>Î”ÎŸÎ¥:</b> ${u.doy}<br><b>ĞšĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ:</b> ${u.company}<br><b>Ğ”ĞµÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:</b> ${u.activity}<br><b>ĞĞ´Ñ€ĞµÑ:</b> ${u.companyAddress}</div></div>`;
    }
    h+=`<h4 style="margin-top:12px;font-size:13px">ğŸ’³ ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸</h4>`;
    if(u.payments.length===0)h+=`<p style="font-size:11px;color:#6c757d">ĞĞµÑ‚ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹</p>`;
    u.payments.forEach(p=>{h+=`<div class="payment-item"><div style="font-size:11px"><b>${p.date}</b> â€” ${p.plan||'DEMO'}</div><div class="amount">â‚¬${p.amount.toFixed(2)}</div></div>`;});
    document.getElementById('user-modal-content').innerHTML=h;
    openModal('user-modal');
}

function editUser(id){
    const u=users.find(x=>x.id===id);if(!u)return;
    currentEditUserId=id;
    document.getElementById('edit-name').value=u.name;
    document.getElementById('edit-email').value=u.email;
    document.getElementById('edit-phone').value=u.phone||'';
    document.getElementById('edit-doc-type').value=u.docType;
    document.getElementById('edit-status').value=u.subscription_status;
    document.getElementById('edit-plan').value=u.subscription_plan||'';
    document.getElementById('edit-afm').value=u.afm||'';
    document.getElementById('edit-doy').value=u.doy||'';
    document.getElementById('edit-company').value=u.company||'';
    document.getElementById('edit-activity').value=u.activity||'';
    document.getElementById('edit-company-address').value=u.companyAddress||'';
    toggleTimologioFields();
    openModal('edit-modal');
}

function toggleTimologioFields(){document.getElementById('timologio-section').style.display=document.getElementById('edit-doc-type').value==='Î¤Î™ÎœÎŸÎ›ÎŸÎ“Î™ÎŸ'?'block':'none';}

function saveUserEdit(){
    const u=users.find(x=>x.id===currentEditUserId);if(!u)return;
    u.name=document.getElementById('edit-name').value;
    u.email=document.getElementById('edit-email').value;
    u.phone=document.getElementById('edit-phone').value;
    u.docType=document.getElementById('edit-doc-type').value;
    u.subscription_status=document.getElementById('edit-status').value;
    u.subscription_plan=document.getElementById('edit-plan').value||null;
    u.afm=document.getElementById('edit-afm').value;
    u.doy=document.getElementById('edit-doy').value;
    u.company=document.getElementById('edit-company').value;
    u.activity=document.getElementById('edit-activity').value;
    u.companyAddress=document.getElementById('edit-company-address').value;
    closeModal('edit-modal');updateStats();renderUsers();renderPayments();renderVipUsers();alert('âœ“ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!');
}

function quickVip(id){const u=users.find(x=>x.id===id);if(!u)return;document.getElementById('vip-email-input').value=u.email;document.getElementById('vip-duration').value='forever';document.getElementById('vip-reason').value='';toggleCustomDate();openModal('vip-modal');}

function openAddVipModal(){document.getElementById('vip-email-input').value='';document.getElementById('vip-duration').value='forever';document.getElementById('vip-reason').value='';toggleCustomDate();openModal('vip-modal');}

function toggleCustomDate(){document.getElementById('custom-date-field').style.display=document.getElementById('vip-duration').value==='custom'?'block':'none';}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ VIP (Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ĞºĞ°Ğº Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ)
function activateVIP(){
    const email=document.getElementById('vip-email-input').value.trim();
    const duration=document.getElementById('vip-duration').value;
    const customDate=document.getElementById('vip-custom-date').value;
    const reason=document.getElementById('vip-reason').value.trim();
    if(!email){alert('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ email!');return;}
    const user=users.find(u=>u.email.toLowerCase()===email.toLowerCase());
    if(!user){alert('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!');return;}
    
    // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ´Ğ°Ñ‚Ñƒ (ĞºĞ°Ğº Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ)
    let expiresAt=null;
    if(duration==='forever'){
        const d=new Date();d.setFullYear(d.getFullYear()+100);expiresAt=d.toISOString();
    }else if(duration==='custom'){
        if(!customDate){alert('Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´Ğ°Ñ‚Ñƒ!');return;}
        expiresAt=new Date(customDate).toISOString();
    }else{
        const d=new Date();d.setMonth(d.getMonth()+parseInt(duration));expiresAt=d.toISOString();
    }
    
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ (ĞºĞ°Ğº Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ)
    user.subscription_status='vip';
    user.subscription_plan='VIP';
    user.vip_expires_at=expiresAt;
    user.vip_granted_by=ADMIN_ID;
    user.vip_reason=reason||null;
    
    closeModal('vip-modal');updateStats();renderUsers();renderVipUsers();
    alert(`âœ“ VIP Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!\n\nsubscription_status: vip\nsubscription_plan: VIP\nvip_expires_at: ${expiresAt}\nvip_granted_by: ${ADMIN_ID}\nvip_reason: ${reason||'-'}`);
}

function removeVip(id){
    const u=users.find(x=>x.id===id);if(!u||!confirm(`Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ VIP Ñƒ ${u.name}?`))return;
    u.subscription_status='active';u.subscription_plan='Standard';u.vip_expires_at=null;u.vip_granted_by=null;u.vip_reason=null;
    updateStats();renderUsers();renderVipUsers();
}

function markDocCreated(uid,date){const u=users.find(x=>x.id===uid);const p=u?.payments.find(x=>x.date===date);if(p){p.docCreated=true;renderPayments();}}
function markDocSent(uid,date){const u=users.find(x=>x.id===uid);const p=u?.payments.find(x=>x.date===date);if(p){p.docSent=true;renderPayments();alert(`ğŸ“§ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ ${u.email}!`);}}

function openModal(id){document.getElementById(id).classList.add('active');}
function closeModal(id){document.getElementById(id).classList.remove('active');}
function logout(){if(confirm('Ğ’Ñ‹Ğ¹Ñ‚Ğ¸?'))window.location.href='/';}

function exportUsersToExcel(){const d=users.map(u=>({ID:u.id,Ğ˜Ğ¼Ñ:u.name,Email:u.email,Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:u.phone,Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚:u.docType,Î‘Î¦Îœ:u.afm,ĞšĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ:u.company,subscription_status:u.subscription_status,subscription_plan:u.subscription_plan||'DEMO',Ğ”Ğ°Ñ‚Ğ°:u.created_at,vip_expires_at:u.vip_expires_at||'',vip_granted_by:u.vip_granted_by||'',vip_reason:u.vip_reason||''}));exportToExcel(d,'Î‘Î Î‘Î›Î›Î‘ÎšÎ¤Î—Î£_Users');}
function exportPaymentsToExcel(){const d=[];users.forEach(u=>u.payments.forEach(p=>{d.push({Ğ”Ğ°Ñ‚Ğ°:p.date,Ğ˜Ğ¼Ñ:u.name,Email:u.email,Ğ¡ÑƒĞ¼Ğ¼Ğ°:p.amount,ĞŸĞ»Ğ°Ğ½:p.plan||'DEMO',Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚:u.docType,Î‘Î¦Îœ:u.afm,Stripe:p.stripeReceived?'Ğ”Ğ°':'ĞĞµÑ‚',Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½:p.docCreated?'Ğ”Ğ°':'ĞĞµÑ‚',ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½:p.docSent?'Ğ”Ğ°':'ĞĞµÑ‚'});}));exportToExcel(d,'Î‘Î Î‘Î›Î›Î‘ÎšÎ¤Î—Î£_Payments');}
function exportReferralsToExcel(){const d=[];const refs={};users.forEach(u=>{if(u.referrer){const r=users.find(x=>x.id===u.referrer);if(r){if(!refs[r.id])refs[r.id]={user:r,invited:0,purchased:0};refs[r.id].invited++;if(u.subscription_status!=='demo')refs[r.id].purchased++;}}});Object.values(refs).forEach(r=>{d.push({Ğ˜Ğ¼Ñ:r.user.name,Email:r.user.email,ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¾:r.invited,ĞšÑƒĞ¿Ğ¸Ğ»Ğ¸:r.purchased});});exportToExcel(d,'Î‘Î Î‘Î›Î›Î‘ÎšÎ¤Î—Î£_Referrals');}
function exportVipToExcel(){const d=users.filter(u=>u.subscription_status==='vip').map(u=>({Ğ˜Ğ¼Ñ:u.name,Email:u.email,'VIP Ñ':u.created_at,vip_expires_at:u.vip_expires_at||'',vip_granted_by:u.vip_granted_by||'',vip_reason:u.vip_reason||''}));exportToExcel(d,'Î‘Î Î‘Î›Î›Î‘ÎšÎ¤Î—Î£_VIP');}
function exportToExcel(d,f){const ws=XLSX.utils.json_to_sheet(d);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Data');XLSX.writeFile(wb,f+'.xlsx');}

document.querySelectorAll('.modal-overlay').forEach(m=>{m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('active');});});
</script>
</body>
</html>
